<template>
  <lightning-card>
    <div class="slds-form-element">
      <label 
        class="slds-form-element__label label" 
        for="combobox-id-1" 
        id="combobox-label-id-33" 
        >Relate To
      </label>
      <template if:false={selectedRecord}>
        <div class="slds-form-element__control">
          <div class="slds-combobox_container">
            <div class={boxClass} aria-expanded="true" aria-haspopup="listbox" role="combobox" >
              <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                <div class="defaultClass">
                  <input 
                    type="text" 
                    class="slds-input slds-combobox__input" 
                    id="combobx-id-1" 
                    onclick={handleClick}
                    oninput={handleChange}
                    aria-autocomplete="list" 
                    aria-controls="listbox-id-1" 
                    aria-expanded="false" 
                    aria-haspopup="listbox" 
                    autocomplete="off" 
                    role="combobox" 
                    placeholder="Search...">
                  <span class="slds-icon_container">
                    <lightning-icon 
                                    icon-name="utility:search" 
                                    class="slds-icon-utility-search slds-input__icon slds-input__icon_right slds-searchIcon" 
                                    alternative-text="Approved" size="x-small"></lightning-icon>
                  </span>
                </div>
                <div id="listbox-id-1" class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox">
                  <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                    <template if:true={records.data}>
                      <template for:each={records.data} for:item="record">
                        <li role="presentation" class="slds-listbox__item" key={record.Id}>
                          <div
                              aria-selected="true" 
                              data-id={record.Id} 
                              class="record slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta" 
                              role="option" 
                              tabindex="0"
                              onclick={handleSelect}>
                            <span class="slds-media__body">
                              <span class="slds-listbox__option-text slds-text-heading_small slds-listbox__option-text_entity slds_optiontxt">{record.Name}</span>
                              <template if:true={record.Phone}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">{record.Phone}</span>
                              </template>
                              <template if:true={record.Industry}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Industry: {record.Industry}</span>
                              </template>
                              <template if:true={record.BillingCity}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">City: {record.BillingCity}</span>
                              </template>
                              <template if:true={record.Email}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Email: {record.Email}</span>
                              </template>
                              <template if:true={record.Title}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Title: {record.Title}</span>
                              </template>
                              <template if:true={record.Amount}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Amount: {record.Amount}$</span>
                              </template>
                              <template if:true={record.CloseDate}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Close Date: {record.CloseDate}</span>
                              </template>
                              <template if:true={record.StageName}>
                                <span class="slds-listbox__option-text slds-listbox__option-text_entity slds_optiontxt">Stage: {record.StageName}</span>
                              </template>
                            </span>
                          </div>
                        </li>
                      </template>
                    </template>
                    <template if:false={records.data}>
                      <div>Choose additional information...</div>
                    </template>
                  </ul>
                </div>
              </div>
            </div>
            <!-- <c-filter 
                  onselect={handleSelect}
            ></c-filter>
            <c-filter-change-object
                  onselect ={handleChooseObject}
            ></c-filter-change-object> -->
          </div>
        </div>
      </template>
      <template if:true={selectedRecord}>
        <div class="slds-combobox__form-element label slds-input-has-icon slds-m-right_large
                            slds-input-has-icon_left-right" role="none">
            <input 
            type="text" 
            class="slds-input slds-combobox__input " 
            id="combobx-id-2" 
            onblur={handleBlur} 
            aria-controls="listbox-id-1" 
            autocomplete="off" 
            role="textbox"
            placeholder="Select an Option"
            value={selectedRecord.Name}
            disabled
            >
            <button class="sicon_container slds-button slds-button_icon 
                                   slds-input__icon slds-input__icon_right" 
                            title="Remove selected option"
                            onclick={handleRemove}>
                        <lightning-icon icon-name="utility:close" size="small">

                        </lightning-icon>
                        <span class="slds-assistive-text">Remove selected option</span>
                    </button>
        </div>
      </template>
    </div>
  </lightning-card>
</template>
  